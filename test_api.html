<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Connection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #E67E22;
        }
        button {
            background: #E67E22;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #D35400;
        }
        #result {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            color: #27AE60;
            font-weight: bold;
        }
        .error {
            color: #E74C3C;
            font-weight: bold;
        }
        .info {
            background: #E8F5E9;
            padding: 15px;
            border-left: 4px solid #27AE60;
            margin: 20px 0;
        }
        .warning {
            background: #FFF3E0;
            padding: 15px;
            border-left: 4px solid #F39C12;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç MentMinds API Connection Test</h1>
        
        <div class="info">
            <strong>Instructions:</strong><br>
            1. Make sure you ran <code>python api.py</code> in your terminal<br>
            2. Click the buttons below to test different endpoints<br>
            3. Check the results
        </div>

        <div>
            <h3>Test Endpoints:</h3>
            <button onclick="testHealth()">1. Test Health Check</button>
            <button onclick="testMentors()">2. Test Get Mentors</button>
            <button onclick="testMentees()">3. Test Get Mentees</button>
            <button onclick="testRecommend()">4. Test Recommendations</button>
        </div>

        <div>
            <h3>Try Different URLs:</h3>
            <button onclick="testWithLocalhost()">Use localhost</button>
            <button onclick="testWith127()">Use 127.0.0.1</button>
        </div>

        <div id="result"></div>
    </div>

    <script>
        let baseURL = 'http://localhost:5000/api';
        const result = document.getElementById('result');

        function testWithLocalhost() {
            baseURL = 'http://localhost:5000/api';
            result.innerHTML = '<div class="info">Switched to: ' + baseURL + '<br>Now try testing the endpoints again.</div>';
        }

        function testWith127() {
            baseURL = 'http://127.0.0.1:5000/api';
            result.innerHTML = '<div class="info">Switched to: ' + baseURL + '<br>Now try testing the endpoints again.</div>';
        }

        async function testEndpoint(endpoint, method = 'GET', body = null) {
            result.innerHTML = `<div class="info">Testing ${endpoint}...</div>`;
            
            const startTime = Date.now();
            
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (body) {
                    options.body = JSON.stringify(body);
                }
                
                const response = await fetch(`${baseURL}${endpoint}`, options);
                const elapsed = Date.now() - startTime;
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                result.innerHTML = `
                    <div class="success">‚úÖ SUCCESS!</div>
                    <strong>Endpoint:</strong> ${baseURL}${endpoint}<br>
                    <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                    <strong>Time:</strong> ${elapsed}ms<br>
                    <strong>Response:</strong><br>
                    ${JSON.stringify(data, null, 2)}
                `;
                
            } catch (error) {
                const elapsed = Date.now() - startTime;
                
                let errorDetails = '';
                if (error.message.includes('Failed to fetch')) {
                    errorDetails = `
                        <div class="warning">
                            <strong>Connection Refused</strong><br>
                            This usually means:<br>
                            ‚Ä¢ The API is not running<br>
                            ‚Ä¢ Firewall is blocking the connection<br>
                            ‚Ä¢ Wrong port number<br><br>
                            <strong>Solutions:</strong><br>
                            1. Check if API is running: Look for "Starting server on..." message<br>
                            2. Try using 127.0.0.1 instead (click button above)<br>
                            3. Check firewall settings<br>
                            4. Verify the port is 5000
                        </div>
                    `;
                } else if (error.message.includes('CORS')) {
                    errorDetails = `
                        <div class="warning">
                            <strong>CORS Error</strong><br>
                            Make sure flask-cors is installed:<br>
                            <code>pip install flask-cors</code>
                        </div>
                    `;
                }
                
                result.innerHTML = `
                    <div class="error">‚ùå ERROR</div>
                    <strong>Endpoint:</strong> ${baseURL}${endpoint}<br>
                    <strong>Error:</strong> ${error.message}<br>
                    <strong>Time:</strong> ${elapsed}ms<br>
                    ${errorDetails}
                `;
            }
        }

        async function testHealth() {
            await testEndpoint('/health');
        }

        async function testMentors() {
            await testEndpoint('/mentors');
        }

        async function testMentees() {
            await testEndpoint('/mentees');
        }

        async function testRecommend() {
            await testEndpoint('/recommend', 'POST', {
                mentee_id: 161,
                top_k: 3
            });
        }

        // Auto-test on load
        window.onload = function() {
            result.innerHTML = `
                <div class="info">
                    <strong>Ready to test!</strong><br><br>
                    Current API URL: <code>${baseURL}</code><br><br>
                    Click a button above to start testing.<br><br>
                    If tests fail, try clicking "Use 127.0.0.1" and test again.
                </div>
            `;
        };
    </script>
</body>
</html>
